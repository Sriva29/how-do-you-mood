<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>How Do You Mood?</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Happy+Monkey&family=Indie+Flower&display=swap" rel="stylesheet">
    <script src="//cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
</head>
<body>

<script type="module">
// Custom class 1: ButtonMakerExtraordinaire.js
// Used to create and animate buttons
import ButtonMakerExtraordinaire from '/scripts/ButtonMakerExtraordinaire.js';
// Custom class 2: ImageSelector.js
// Used to display images for selection. Can position and animate images
import ImageSelector from '/scripts/ImageSelector.js';
// Custom class 3: CreateTitle.js
// Used to create and animate title
import CreateTitle from '/scripts/CreateTitle.js';

class MainScene extends Phaser.Scene {
    constructor() {
        super({ key: 'MainScene' });
    }

    preload() {
        const imageNames = [
            'beach',
            'bg-frame',
            'blowing-bubbles',
            'boy',
            'bunny-dab',
            'canvas',
            'cat-dab',
            'coffee',
            'cooking',
            'dog-dab',
            'girl',
            'loading',
            'moon',
            'mountain',
            'party',
            'pink',
            'purple',
            'quill',
            'red',
            'river',
            'stars',
            'sun',
            'surfing',
            'table',
            'windmill',
            'yellow'
        ];

        imageNames.forEach(name => {
            this.load.image(name, `images/${name}.png`);
        });
    }
    
    create() {
        this.title = new CreateTitle(this, "How do you mood?");

        this.title.moveTo(this.cameras.main.centerX, 200);

        this.createButtons();
    }

    createButtons(){
        this.dunno = new ButtonMakerExtraordinaire(this, 'I don\'t know', this.cameras.main.centerX - 100, this.cameras.main.centerY, 200, 50, 10,()=>{
                this.handleDunnoTimes();
            });
        // this.doKnow = new ButtonMakerExtraordinaire(this, 'I DO know', this.cameras.main.centerX - 100, 425, 200, 50, 10);
    }

    handleDunnoTimes() {
        console.log('animating the title away!!!');
        // this.tweens.add({
        //     targets: this.title,
        //     y: -100,
        //     duration: 1000,
        //     ease: 'Power2'
        // })
        this.title.moveTo(this.cameras.main.centerX, 300);

        this.dunno.animateButton(-700,0, 1000, 'Power2');
        setTimeout(()=>{
            
            this.dunno.setText("Restart");
            // this.title.y = -100;
            // this.tweens.add({
            //     targets: this.title,
            //     y: 200,
            //     duration: 1000,
            //     ease: 'Power2'
            // })
            this.title.animate({y: -200, alpha:0}, 1000, 'Power2');
        }, 1000);
        // After animation, activate ImageSelector to display images
        setTimeout(() => {
            // this.title.updateText('Choose an animal');
            // this.title.animate({y: -200, alpha:1}, 1000, 'Power2');
            // Display images for selection
            this.scene.start('QuestionsScene');            
        }, 1250);
    }
}

class QuestionsScene extends Phaser.Scene {
    constructor() {
        super({ key: 'QuestionsScene' });
    }
    
    create() {
        const centerX = this.cameras.main.centerX;
        const centerY = this.cameras.main.centerY;
        // adding the title and button again
        this.title = new CreateTitle(this, "Choose an animal (or don't, I am not your boss)");

        this.title.moveTo(this.cameras.main.centerX, 300);
        
        this.createButtons();

        console.log('QuestionsScene');
        // Initialize ImageSelector here instead if this is the intended scene
        const imageKeys = ['bunny-dab', 'dog-dab', 'cat-dab']; // Specify your image keys
        this.imageSelector = new ImageSelector(this, imageKeys, (selectedKey) => {
            console.log(`Image ${selectedKey} selected`);
            // Handle the selection here
        });
        // Assuming displayImages method is corrected to manage visibility as intended
        this.imageSelector.displayImages();
        this.imageSelector.scaleImages(0.16);
        this.imageSelector.pos([
            { x: centerX+200, y: centerY},  
            { x: centerX+200, y: centerY},  
            { x: centerX+200, y: centerY}
        ]);
        console.log(this.cameras.main.centerY);
        // animate parameters: index, properties, duration, ease
        this.imageSelector.animateImage(0, { x: centerX-200, alpha:1}, 1000, 'power2');
        this.imageSelector.animateImage(1, { x: centerX-0, alpha:1 }, 1500, 'power3');
        this.imageSelector.animateImage(2, { x: centerX+200, alpha:1}, 2000, 'power2');
        console.log('displaying cute animals');
    }

    createButtons(){
        this.restart = new ButtonMakerExtraordinaire(this, 'Restart', this.cameras.main.centerX - 800, this.cameras.main.centerY, 200, 50, 10,()=>{
                this.scene.start('MainScene');
            });
        // this.doKnow = new ButtonMakerExtraordinaire(this, 'I DO know', this.cameras.main.centerX - 100, 425, 200, 50, 10);
    }
}

class ImageGenScene extends Phaser.Scene {
    constructor() {
        super({ key: 'ImageGenScene' });
    }

    create() {
        
        const imageKeys = ['bunny-dab', 'dog-dab', 'cat-dab'];
        this.imageSelector = new ImageSelector(this, imageKeys, (selectedKey) => {
        console.log(`Image ${selectedKey} selected`);
        // Handle selection (store the selection or update the UI)
        });
        this.imageSelector.displayImages(); 
    }
}

const game = new Phaser.Game({
    type: Phaser.AUTO,
    scale: {
        mode: Phaser.Scale.FIT,
        parent: 'phaser-example',
        autoCenter: Phaser.Scale.CENTER_BOTH,
        width: 1920, // Base width
        height: 1080, // Base height
    },
    backgroundColor: '#00E0EA', //cyan
    scene: [MainScene, QuestionsScene, ImageGenScene]
});
</script>

</body>
</html>
